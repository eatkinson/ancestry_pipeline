Elizbeth Atkinson, 2/26/19
@eatkinson (Github handle)

RFMix Version 2 output is formatted differently from V1. To collapse bed files and prepare them for plotting, I have written up the bash code below. I hope this is of use to others!

First, you have to make a new file with the location of SNPs, which I suffic snp_loc:
for i in {1..22}; do awk '{ if ($1!~"#") print $0 }' FILE.chr$i.msp.tsv | awk '{ if ($1!~"#") print $0 }'| cut -f2,4 > FILE.chr$i.rfmix.snp_loc ;done

Then you need to reformat the *.msp.tsv output file to the format that RFmixv1 had, previously called 'viterbi':
for i in {1..22}; do awk '{ if ($1!~"#") print $0 }' FILE.chr$i.msp.tsv | awk '{ if ($1!~"#") print $0 }' > FILE.chr$i.msp1.tsv  ; done
for i in {1..22}; do cut -f7- FILE.chr$i.msp1.tsv > FILE.chr$i.Viterbi.tsv ; done

Then I cycle through all the individuals and make their collapsed bed files with a modified version of a script from Aliciaâ€™s ancestry pipeline, attached here:
cat Indivs.txt | while read line; do \
python collapse_ancestry1.py \
--rfmix FILE.chr1.Viterbi.tsv \
--snp_locations FILE.chr1.rfmix.snp_loc \
--ind $line \
--ind_info Indivs.txt \
--pop_labels "Pop1,Pop2" \
--out $line ; done 

so I cat a list of all the individuals by name so that I can name each bed file with that person. Then you can run the karyogram plotting script Alicia wrote on these collapsed bed files. For completeness, here's some code for how I did this too:
cat Indivs.txt | while read line; do \
python plot_karyogram.py \
--bed_a $line.A.bed \
--bed_b $line.B.bed \
--ind $line \
--centromeres centromeres_hg19.bed \
--pop_order Pop1,Pop2 \
--out $line.png \
--colors "#CD0000,#66CDAA" \
;done

You can change the colors to whatever you want, the script just needs the hex code like that. 

